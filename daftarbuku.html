
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Daftar Bukuku - Penjual</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: #f9f9f9;
      margin: 0;
      padding: 20px;
    }

    h2 {
      text-align: center;
      color: #2c3e50;
    }

    #bookGrid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 20px;
      margin-top: 30px;
    }

    .book-card {
      background-color: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      overflow: hidden;
      transition: transform 0.3s;
    }

    .book-card:hover {
      transform: translateY(-5px);
    }

    .book-card img {
      width: 100%;
      height: 200px;
      object-fit: cover;
    }

    .book-info {
      padding: 15px;
    }

    .book-info h3 {
      margin: 0 0 10px;
      font-size: 18px;
      color: #333;
    }

    .book-info p {
      margin: 5px 0;
      font-size: 14px;
      color: #666;
    }

    .status {
      font-weight: bold;
      padding: 6px 10px;
      border-radius: 6px;
      display: inline-block;
      font-size: 13px;
    }

    .approved { background-color: #2ecc71; color: white; }
    .pending { background-color: #f39c12; color: white; }
    .rejected { background-color: #e74c3c; color: white; }

    .btn {
      margin-top: 10px;
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      cursor: pointer;
    }

    .edit { background-color: #3498db; color: white; margin-right: 8px; }
    .delete { background-color: #e74c3c; color: white; }

    #editModal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      max-width: 400px;
      width: 100%;
    }

    .modal-content input, .modal-content textarea {
      width: 100%;
      padding: 8px;
      margin: 6px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .modal-content button {
      width: 100%;
      background: #2ecc71;
      color: white;
      border: none;
      padding: 10px;
      margin-top: 10px;
      border-radius: 6px;
      cursor: pointer;
    }

    .close-btn {
      float: right;
      font-weight: bold;
      cursor: pointer;
    }
  </style>
</head>
<body>

<h2>Daftar Buku Saya</h2>
<div id="bookGrid"></div>

<!-- Modal Edit -->
<div id="editModal">
  <div class="modal-content">
    <span class="close-btn" onclick="closeModal()">X</span>
    <h3>Edit Buku</h3>
    <input type="text" id="editTitle" placeholder="Judul Buku" required>
    <input type="text" id="editCategory" placeholder="Kategori" required>
    <input type="number" id="editPrice" placeholder="Harga" required>
    <textarea id="editDescription" placeholder="Deskripsi" required></textarea>
    <input type="url" id="editImage" placeholder="URL Gambar" required>
    <button onclick="saveChanges()">Simpan Perubahan</button>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDiwuveb5FRuMQmOG_A1Yoikr2uJ66Yn2A",
    authDomain: "peppy-nation-438101-b2.firebaseapp.com",
    databaseURL: "https://peppy-nation-438101-b2-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "peppy-nation-438101-b2"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  let currentEditId = null;

  firebase.auth().onAuthStateChanged(function(user) {
    if (user) {
      const uid = user.uid;
      db.ref("users/" + uid).once("value").then(function(snapshot) {
        const userData = snapshot.val();
        if (userData && userData.role === "penjual") {
          db.ref("books").orderByChild("submittedBy").equalTo(uid).on("value", function(snapshot) {
            const grid = document.getElementById("bookGrid");
            grid.innerHTML = "";
            snapshot.forEach(function(child) {
              const book = child.val();
              const card = document.createElement("div");
              card.className = "book-card";
              card.innerHTML = `
                <img src="${book.image}" alt="${book.title}">
                <div class="book-info">
                  <h3>${book.title}</h3>
                  <p><strong>Kategori:</strong> ${book.category}</p>
                  <p><strong>Harga:</strong> Rp${parseInt(book.price).toLocaleString()}</p>
                  <p><strong>Status:</strong> <span class="status ${book.status}">${book.status}</span></p>
                  <button class="btn edit" onclick="editBook('${child.key}', ${JSON.stringify(book).replace(/"/g, '&quot;')})">Edit</button>
                  <button class="btn delete" onclick="deleteBook('${child.key}')">Hapus</button>
                </div>
              `;
              grid.appendChild(card);
            });
          });
        } else {
          alert("Akses ditolak. Halaman ini hanya untuk penjual.");
          window.location.href = "index.html";
        }
      });
    } else {
      alert("Silakan login terlebih dahulu.");
      window.location.href = "login.html";
    }
  });

  function editBook(id, data) {
    currentEditId = id;
    document.getElementById("editTitle").value = data.title;
    document.getElementById("editCategory").value = data.category;
    document.getElementById("editPrice").value = data.price;
    document.getElementById("editDescription").value = data.description;
    document.getElementById("editImage").value = data.image;
    document.getElementById("editModal").style.display = "flex";
  }

  function closeModal() {
    document.getElementById("editModal").style.display = "none";
  }

  function saveChanges() {
    const updatedData = {
      title: document.getElementById("editTitle").value,
      category: document.getElementById("editCategory").value,
      price: parseFloat(document.getElementById("editPrice").value),
      description: document.getElementById("editDescription").value,
      image: document.getElementById("editImage").value
    };

    firebase.database().ref("books/" + currentEditId).update(updatedData).then(() => {
      alert("Buku berhasil diperbarui.");
      closeModal();
    });
  }

  function deleteBook(id) {
    if (confirm("Yakin ingin menghapus buku ini?")) {
      firebase.database().ref("books/" + id).remove().then(() => {
        alert("Buku berhasil dihapus.");
      });
    }
  }
</script>

</body>
</html>
